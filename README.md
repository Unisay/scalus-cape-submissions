# Scalus UPLC-CAPE Submissions

This repository contains [UPLC-CAPE](https://github.com/IntersectMBO/UPLC-CAPE) submissions implemented in [Scalus](https://scalus.org).

## Setup

This project uses Nix flakes for reproducible development environment:

```bash
# Allow direnv (one-time)
direnv allow

# Or manually enter nix shell
nix develop
```

## Project Structure

```
.
├── src/                           # Scala source code & UPLC outputs
│   ├── fibonacci/                 # Optimized fibonacci (manual UPLC)
│   │   ├── Fibonacci.scala
│   │   ├── fibonacci.uplc
│   │   └── README.md
│   ├── fibonacci_prepacked/       # Pre-packed ByteString lookup (O(1))
│   │   ├── FibonacciPrepacked.scala
│   │   └── fibonacci.uplc
│   ├── fibonacci_naive_recursion/ # Naive recursive fibonacci
│   │   ├── FibonacciNaiveRecursion.scala
│   │   ├── fibonacci.uplc
│   │   └── README.md
│   ├── factorial/                 # Optimized factorial
│   │   ├── Factorial.scala
│   │   ├── factorial.uplc
│   │   └── README.md
│   └── factorial_naive_recursion/ # Naive recursive factorial
│       ├── FactorialNaiveRecursion.scala
│       ├── factorial.uplc
│       └── README.md
├── build.sbt                      # sbt build configuration
└── flake.nix                      # Nix development environment
```

## Building

Compile all Scala sources:

```bash
sbt compile
```

Generate UPLC programs:

```bash
# Build all scenarios (recommended)
build-scalus

# Or individually:
sbt "runMain fibonacci.compileFibonacci"
sbt "runMain fibonacci_prepacked.compileFibonacciPrepacked"
sbt "runMain fibonacci_naive_recursion.compileFibonacciNaiveRecursion"
sbt "runMain factorial.compileFactorial"
sbt "runMain factorial_naive_recursion.compileFactorialNaiveRecursion"
```

**Note:** UPLC output files are generated in the same directory as the source code (`src/<scenario>/`).

## Scenarios

### Fibonacci

Three different implementations of the Fibonacci function:

#### `fibonacci/` - Optimized (Manual UPLC)

Hand-crafted UPLC using fixed-point combinator with tail recursion.

- **Build:** `sbt "runMain fibonacci.compileFibonacci"`
- **Output:** `src/fibonacci/fibonacci.uplc`
- **Performance:** CPU 115.87, Memory 0.43 (for fib(10))

#### `fibonacci_prepacked/` - Pre-packed ByteString

Pre-computed lookup table stored as ByteString constant (O(1) lookup).

- **Build:** `sbt "runMain fibonacci_prepacked.compileFibonacciPrepacked"`
- **Output:** `src/fibonacci_prepacked/fibonacci.uplc`
- **Performance:** CPU 1.75, Memory 0.003 (for fib(10)) - **66x faster!**
- **Range:** Supports n ∈ [0, 25]

#### `fibonacci_naive_recursion/` - Naive Recursive

Naive recursive implementation matching mathematical definition.

- **Build:** `sbt "runMain fibonacci_naive_recursion.compileFibonacciNaiveRecursion"`
- **Output:** `src/fibonacci_naive_recursion/fibonacci.uplc`

### Factorial

Two implementations of the factorial function:

#### `factorial/` - Optimized

Optimized factorial implementation.

- **Build:** `sbt "runMain factorial.compileFactorial"`
- **Output:** `src/factorial/factorial.uplc`

#### `factorial_naive_recursion/` - Naive Recursive

Naive recursive factorial implementation.

- **Build:** `sbt "runMain factorial_naive_recursion.compileFactorialNaiveRecursion"`
- **Output:** `src/factorial_naive_recursion/factorial.uplc`

## UPLC-CAPE Submission Format

Each scenario directory in `src/` contains:

- `<ScenarioName>.scala` - Source code implementation
- `<scenario>.uplc` - Compiled UPLC program (parameterized lambda function)
- `README.md` - Implementation description (optional)

**Note:** Configuration and metadata files (config.json, metadata.json, metrics.json) are generated by the UPLC-CAPE benchmark framework and should not be committed to this repository.
